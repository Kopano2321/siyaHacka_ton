{% extends 'plants/base.html' %}

{% block content %}
<h1>Dashboard</h1>

<div class="row mt-4">
    <!-- Today's Progress -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Today's Progress</h5>
                <div class="progress-circle" style="--progress: {{ completion_rate }}%">
                    <div class="progress-circle-inner">
                        <strong>{{ completed_tasks }}/{{ total_tasks }}</strong>
                    </div>
                </div>
                <p class="text-center mt-2">{{ completion_rate }}% completed</p>
            </div>
        </div>
    </div>

    <!-- Climate Overview -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Climate Overview</h5>
                <div class="row">
                    <div class="col-6">
                        <h6>Urgent Tasks</h6>
                        <h3>{{ urgent_tasks }}</h3>
                    </div>
                    <div class="col-6">
                        <h6>Avg Moisture</h6>
                        <h3>{{ climate.avg_moisture }}%</h3>
                    </div>
                </div>
                {% if climate.avg_moisture < climate.target_moisture %}
                <div class="alert alert-warning mt-2">
                    Requires immediate action {{ climate.target_moisture|floatformat:0 }}% below target
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- My Tasks -->
<div class="row mt-4">
    <div class="col-12">
        <h3>My Tasks</h3>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="urgent-tab" data-bs-toggle="tab" data-bs-target="#urgent" type="button" role="tab" aria-controls="urgent" aria-selected="true">Urgent</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="high-tab" data-bs-toggle="tab" data-bs-target="#high" type="button" role="tab" aria-controls="high" aria-selected="false">High Priority</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="other-tab" data-bs-toggle="tab" data-bs-target="#other" type="button" role="tab" aria-controls="other" aria-selected="false">Other Tasks</button>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <!-- Urgent Tasks -->
            <div class="tab-pane fade show active" id="urgent" role="tabpanel" aria-labelledby="urgent-tab">
                {% for task in tasks_by_priority.urgent %}
                <div class="card task-card task-urgent">
                    <div class="card-body">
                        <h5 class="card-title">{{ task.title }}</h5>
                        <p class="card-text">{{ task.description }}</p>
                        <p class="card-text"><small class="text-muted">{{ task.category }} • {{ task.field.section }}, {{ task.field.plot }}</small></p>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- High Priority -->
            <div class="tab-pane fade" id="high" role="tabpanel" aria-labelledby="high-tab">
                {% for task in tasks_by_priority.high %}
                <div class="card task-card task-high">
                    <div class="card-body">
                        <h5 class="card-title">{{ task.title }}</h5>
                        <p class="card-text">{{ task.description }}</p>
                        <p class="card-text"><small class="text-muted">{{ task.category }} • {{ task.field.section }}, {{ task.field.plot }}</small></p>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Other Tasks (Medium and Low) -->
            <div class="tab-pane fade" id="other" role="tabpanel" aria-labelledby="other-tab">
                {% for task in tasks_by_priority.medium %}
                <div class="card task-card task-medium">
                    <div class="card-body">
                        <h5 class="card-title">{{ task.title }}</h5>
                        <p class="card-text">{{ task.description }}</p>
                        <p class="card-text"><small class="text-muted">{{ task.category }} • {{ task.field.section }}, {{ task.field.plot }}</small></p>
                    </div>
                </div>
                {% endfor %}
                {% for task in tasks_by_priority.low %}
                <div class="card task-card task-low">
                    <div class="card-body">
                        <h5 class="card-title">{{ task.title }}</h5>
                        <p class="card-text">{{ task.description }}</p>
                        <p class="card-text"><small class="text-muted">{{ task.category }} • {{ task.field.section }}, {{ task.field.plot }}</small></p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}